<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="{74AF2CB7-1C73-4E46-B37E-123595EAED09}"
           Name="Elite Switch"
           Language="1033"
           Version="1.0.0.0"
           Manufacturer="Elite Switch"
           UpgradeCode="A1B2C3D4-E5F6-4A5B-8C9D-0E1F2A3B4C5D">

    <Package InstallerVersion="500"
             Compressed="yes"
             InstallScope="perMachine"
             Description="Elite Dangerous VR/Monitor Mode Switcher"
             Comments="Elite Switch Installer"
             Platform="x64" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <!-- Request administrator privileges -->
    <Condition Message="This application requires administrator privileges to install.">
      Privileged
    </Condition>

    <!-- Icon for Add/Remove Programs -->
    <Icon Id="EliteSwitchIcon.exe" SourceFile="$(var.EliteSwitch.TargetDir)EliteSwitch.exe" />
    <Property Id="ARPPRODUCTICON" Value="EliteSwitchIcon.exe" />

    <!-- Add/Remove Programs properties -->
    <Property Id="ARPHELPLINK" Value="https://github.com/yourusername/eliteswitch" />
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />

    <!-- Directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="EliteSwitch">
          <Component Id="ApplicationFiles" Guid="{6A5B4C3D-2E1F-4A5B-8C9D-0E1F2A3B4C5D}" Win64="yes">
            <File Id="EliteSwitch.exe" Source="$(var.EliteSwitch.TargetDir)EliteSwitch.exe" KeyPath="yes">
              <Shortcut Id="StartMenuShortcut"
                        Directory="ProgramMenuFolder"
                        Name="Elite Switch"
                        Description="Elite Dangerous VR/Monitor Mode Switcher"
                        WorkingDirectory="INSTALLFOLDER"
                        Icon="EliteSwitchIcon.exe"
                        Advertise="yes" />
            </File>

            <!-- Include all dependencies -->
            <File Id="EliteSwitch.dll" Source="$(var.EliteSwitch.TargetDir)EliteSwitch.dll" />
            <File Id="EliteSwitch.deps.json" Source="$(var.EliteSwitch.TargetDir)EliteSwitch.deps.json" />
            <File Id="EliteSwitch.runtimeconfig.json" Source="$(var.EliteSwitch.TargetDir)EliteSwitch.runtimeconfig.json" />
            <File Id="icon.ico" Source="$(var.EliteSwitch.TargetDir)icon.ico" />

            <!-- AudioSwitcher dependencies -->
            <File Id="AudioSwitcher.AudioApi.dll" Source="$(var.EliteSwitch.TargetDir)AudioSwitcher.AudioApi.dll" />
            <File Id="AudioSwitcher.AudioApi.CoreAudio.dll" Source="$(var.EliteSwitch.TargetDir)AudioSwitcher.AudioApi.CoreAudio.dll" />

            <!-- H.NotifyIcon dependencies -->
            <File Id="H.NotifyIcon.Wpf.dll" Source="$(var.EliteSwitch.TargetDir)H.NotifyIcon.Wpf.dll" />
            <File Id="H.NotifyIcon.dll" Source="$(var.EliteSwitch.TargetDir)H.NotifyIcon.dll" />
          </Component>

          <!-- Registry entry for Run at startup (optional, commented out by default) -->
          <!--
          <Component Id="RegistryEntries" Guid="{7B6C5D4E-3F20-4B5C-9D0E-1F2A3B4C5D6E}" Win64="yes">
            <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Run">
              <RegistryValue Name="EliteSwitch" Value="[INSTALLFOLDER]EliteSwitch.exe" Type="string" KeyPath="yes" />
            </RegistryKey>
          </Component>
          -->
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" />
    </Directory>

    <!-- Feature tree -->
    <Feature Id="ProductFeature" Title="Elite Switch" Level="1">
      <ComponentRef Id="ApplicationFiles" />
      <!-- Uncomment to enable startup: <ComponentRef Id="RegistryEntries" /> -->
    </Feature>

    <!-- Use WixUI_InstallDir dialog set -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Skip license dialog (or provide License.rtf) -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
  </Product>
</Wix>
